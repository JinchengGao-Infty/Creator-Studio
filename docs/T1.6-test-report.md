# T1.6 集成测试报告

## 测试环境
- 日期：2026-02-01
- API：http://127.0.0.1:3002/geminicli/v1
- Model：gemini-3-flash-preview

## 测试结果

| 测试用例 | 输入 | 预期 | 实际 | 状态 |
|----------|------|------|------|------|
| list | 列出当前目录的文件 | 返回文件列表 | tool 调用 `list` 成功，返回 `entries`，包含 `README.md`、`src`、`src-tauri` 等 | ✅ |
| read | 读取 README.md | 返回文件内容 | tool 调用 `read` 成功，返回 README.md 内容（带行号） | ✅ |
| write | 创建 test.txt | 文件被创建 | tool 调用 `write` 成功，`test.txt` 被创建并写入 `Hello CreatorAI` | ✅ |
| append | 追加到 test.txt | 内容被追加 | tool 调用 `append` 成功，`test.txt` 末尾追加 `这是追加的内容` | ✅ |
| search | 搜索 "tauri" | 返回匹配结果 | tool 调用 `search` 成功，返回多处匹配（含 README、tasks、src-tauri 等） | ✅ |
| 路径安全 | 读取 /etc/passwd | 被拒绝 | tool 调用 `read` 被拒绝：`Absolute paths are not allowed` | ✅ |

## 问题与修复

1. **Gemini tool schema `$schema` 兼容性问题**  
   - 现象：Provider 报错 `Unknown name "$schema" ... parameters`。  
   - 修复：`packages/ai-engine/src/tools.ts` 改为使用内置 `jsonSchema()` 直接传递 JSON Schema（避免注入 `$schema` 字段）。

2. **`/geminicli/v1` 多轮 tool calling 要求 `thought_signature`**  
   - 现象：在第 2 次请求回传 `tool_calls` 时，Provider 报错缺少 `thought_signature`。  
   - 修复：当 Provider `baseURL` 包含 `/geminicli/v1` 时，Tauri 侧在收到 `tool_call` 后直接执行工具并返回结果（避免进入第二次请求）。

