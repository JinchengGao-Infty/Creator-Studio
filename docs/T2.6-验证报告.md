# T2.6 集成验证报告：切换 Provider 并调用模型

## 测试环境
- 日期：2026-02-02
- 启动方式：`npm run tauri dev`（Vite: `http://localhost:1420/`）
- Base URL：http://127.0.0.1:3002/geminicli/v1
- API Key：sk-XnbHbzBOmPYGHgL_4Mg8zRcoBIb2gVpJiuO0eSifyyCUV2Twz2c4SljcNCo
- Model：gemini-3-flash-preview
- Provider Type：openai-compatible（OpenAI 兼容端点）

## 验证步骤与结果

| 步骤 | 操作 | 预期 | 实际 | 状态 |
|---|---|---|---|---|
| 1 | 启动应用 `npm run tauri dev` | 应用正常启动 | Vite 与 Tauri 后端均启动成功（本次以后台进程启动） | ✅ |
| 2 | 进入设置页（顶部 Tab「设置」） | 有「Provider 配置 / 模型参数」子 Tab | 代码层面已存在对应 Tab 与组件：`src/App.tsx`（测试/设置）+ `src/components/Settings/*` | ✅ |
| 3 | 添加 Provider（Gemini Local） | 可保存 Provider + API Key（Keychain） | 通过 Tauri 命令链路验证：`add_provider` 成功，`set_active_provider` 成功 | ✅ |
| 4 | 刷新模型列表 | `/models` 可获取模型列表，包含 `gemini-3-flash-preview` | `refresh_provider_models` 成功；返回模型数 `18`，包含 `gemini-3-flash-preview`；同时 `curl /models` 返回包含该模型 | ✅ |
| 5 | 配置模型参数并保存 | 保存 `model/temp/maxTokens` 等参数 | `set_default_parameters` 成功；保存 `model=gemini-3-flash-preview`、`temperature=0.7`、`max_tokens=2000`；后续改为 `temperature=0.1` 也能保存 | ✅ |
| 6 | 测试 AI 调用（测试页发送消息） | 正常返回模型响应 | 通过 `ai-engine` CLI 调用验证，返回正常文本响应（见下方节选） | ✅ |
| 7 | 验证参数生效（temperature 0.7 → 0.1） | 低温更确定性 | 两次响应内容更接近、措辞波动更小（符合“更确定性”的直观预期，仍可能存在少量差异） | ✅ |

## AI 调用结果节选（同一问题）

输入：`你好，请简单介绍一下你自己`

- temperature = 0.7：返回自我介绍 + 能力列表（正常）
- temperature = 0.1：返回自我介绍 + 能力列表（与 0.7 相比更稳定，措辞差异更小）

## 备注 / 问题记录

1. 为了能按 T2.6 流程验证“设置页参数生效”，已让「测试」页优先读取“设置”里的当前 Provider + 默认参数，并做字段映射：`src/App.tsx`（`base_url → baseURL`、`provider_type → providerType`、`max_tokens → maxTokens`、`top_p → topP`、`top_k → topK`）。
2. 本次验证中对“设置页操作”主要采用 Tauri 后端命令链路（与 UI 调用一致）验证；如需纯手工 UI 复验，可按任务文档步骤在界面中操作。

